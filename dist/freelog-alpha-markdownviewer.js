!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);r(1);var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function o(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(o.prototype,HTMLElement.prototype),Object.setPrototypeOf(o,HTMLElement);var i=r(6),a=r(7).freelogConfig.dependencies,s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e;return e.innerHTML=i,r.root=document.body,r.loadData().then(function(e){r.$viewerWrap=r.root.querySelector(".md-viewer-wrap"),r.$viewer=r.root.querySelector(".js-md-viewer"),r.$viewerTitle=r.root.querySelector(".js-md-title"),r.responseList=e,r.renderList(e),setTimeout(function(){r.bindEvent()},20)}).catch(function(e){console.warn(e)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),n(t,[{key:"connectedCallback",value:function(){}},{key:"loadData",value:function(){return window.FreelogApp.QI.fetch("/v1/presentables?nodeId="+window.__auth_info__.__auth_node_id__+"&resourceType=markdown").then(function(e){return e.json()}).then(function(e){var t=(e.data.dataList||[]).map(function(e){return window.FreelogApp.QI.fetchPresentableResourceData(e.presentableId).then(function(t){return{response:t,detail:e}})});return Promise.all(t)}).then(function(e){var t=[];return e.forEach(function(e){var r=e.response;!r.headers.get("freelog-resource-type")?t.push(r.json().then(function(t){return e.json=t,e})):t.push(r.text().then(function(t){return e.text=t,e}))}),Promise.all(t)})}},{key:"renderTitle",value:function(e){return'<li class="md-title js-md-title js-md-title-'+e.index+'" data-index="'+e.index+'">'+(e.index+1)+". "+e.detail.presentableName+"</li>"}},{key:"loadPresentable",value:function(e){return window.FreelogApp.QI.fetchPresentableResourceData(e).then(function(e){return!e.headers.get("freelog-resource-type")?e.json():e.text()})}},{key:"renderMarkdown",value:function(e){var t=this;window.FreelogApp.QI.requireSubResource(a["markdown-parser"]).then(function(){t.$viewer.innerHTML="",new window.MarkdownParser({container:t.$viewer,renderImageError:function(e,t){e.src="","string"==typeof t&&(e.src=""),console.log("renderImageError",arguments)}}).render(e.text)})}},{key:"reanderHead",value:function(e){var t=e.detail.presentableName,r=new Date(e.detail.createDate).toLocaleDateString(),n='<div class="article-title"><time datetime="'+r+'">'+r+"</time><h3>"+t+"</h3></div>";this.$viewerTitle.innerHTML=n}},{key:"renderError",value:function(e){var t=window.FreelogApp.getErrorInfo(e.json||e),r='<span class="error-tip">'+t.desc+'</span>\n                         <button class="action-btn js-to-do" data-index="'+e.index+'">'+t.tip+"</button>";this.$viewer.innerHTML=r}},{key:"renderList",value:function(e){var t=this,r="",n=this.root.querySelector(".js-md-titles");e.forEach(function(e,n){e.index=n,r+=t.renderTitle(e)}),r?(n.innerHTML=r,this.renderContent(this.responseList[0])):this.root.querySelector(".js-md-viewer").innerHTML="没有找到文章..."}},{key:"renderContent",value:function(e){var t=this.root.querySelector(".js-md-title-"+e.index);this.reanderHead(e),e.json?(this.$viewerWrap.classList.add("md-error-wrap"),this.renderError(e)):(this.$viewerWrap.classList.remove("md-error-wrap"),this.renderMarkdown(e));var r=this.root.querySelector(".js-md-title.selected");r&&r.classList.remove("selected"),t.classList.add("selected")}},{key:"bindEvent",value:function(){var e=this;e.root.querySelector(".js-wrapper").addEventListener("click",function(t){var r=t.target.classList;r.contains("js-to-do")?function(t){var r=t.target.dataset.index,n=e.responseList[r];window.FreelogApp.trigger("HANDLE_INVALID_RESPONSE",{response:n.json,callback:function(){e.loadPresentable(n.detail.presentableId).then(function(t){var n=e.responseList[r];"string"==typeof t?(n.text=t,e.renderMarkdown(n)):(n.json=t,e.renderError(n))})}})}(t):r.contains("js-md-title")&&function(t){var r=t.target.dataset.index,n=e.responseList[r];e.renderContent(n)}(t)},!1)}}]),t}();customElements.define("freelog-alpha-markdownviewer",s)},function(e,t,r){var n=r(2);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(4)(n,o);n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(3)(!1)).push([e.i,".freelog-alpha-markdownviewer-app .wrapper{padding:15px 0 15px 15px;background:#fff;min-height:100vh}.freelog-alpha-markdownviewer-app .md-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer;line-height:22px;transition:all .2s;padding:2px;font-size:14px}.freelog-alpha-markdownviewer-app .md-title.selected{font-weight:600;font-size:16px;color:#007bff;background-color:#eee}.freelog-alpha-markdownviewer-app .md-title.selected span{color:#007bff}.freelog-alpha-markdownviewer-app .md-title:hover{background-color:#ddd}.freelog-alpha-markdownviewer-app .md-titles{width:300px;position:fixed;top:0;left:0;bottom:0;overflow:auto;background:#fafafa;z-index:1;padding:10px;border-right:1px solid rgba(0,0,0,.07);border-radius:2px}.freelog-alpha-markdownviewer-app .md-viewer-wrap{background:#fff;margin-left:330px;margin-right:300px;overflow:auto}.freelog-alpha-markdownviewer-app .md-error-wrap{margin-right:30px}.freelog-alpha-markdownviewer-app .article-title{border-left:5px solid;margin-bottom:20px;font-size:30px;padding-left:12px;padding-bottom:9px}.freelog-alpha-markdownviewer-app .article-title time{font-size:16px;color:#aaa;float:right;height:58px;line-height:58px;padding-right:40px}.freelog-alpha-markdownviewer-app .article-item{border:1px solid #ddd;border-radius:3px;box-shadow:0 2px 12px 0 rgba(0,0,0,.1)}.freelog-alpha-markdownviewer-app .article-content{padding:12px;overflow:auto}.freelog-alpha-markdownviewer-app .error-tip{color:#e6a23c}.freelog-alpha-markdownviewer-app .action-btn{display:inline-block;line-height:1;white-space:nowrap;border:1px solid #b3d8ff;text-align:center;box-sizing:border-box;outline:none;padding:6px 9px;font-size:14px;border-radius:4px;color:#409eff;background:#ecf5ff;cursor:pointer}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.freelog-alpha-markdownviewer-app .fadeIn{-webkit-animation-name:fadeIn;animation-name:fadeIn;-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=function(e,t){var r=e[1]||"",n=e[3];if(!n)return r;if(t&&"function"==typeof btoa){var o=(a=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"});return[r].concat(i).concat([o]).join("\n")}var a;return[r].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(n[i]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&n[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),t.push(a))}},t}},function(e,t,r){var n,o,i={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),s=function(e){var t={};return function(e,r){if("function"==typeof e)return e();if(void 0===t[e]){var n=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),l=null,c=0,d=[],p=r(5);function u(e,t){for(var r=0;r<e.length;r++){var n=e[r],o=i[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(w(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(w(n.parts[a],t));i[n.id]={id:n.id,refs:1,parts:s}}}}function f(e,t){for(var r=[],n={},o=0;o<e.length;o++){var i=e[o],a=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};n[a]?n[a].parts.push(s):r.push(n[a]={id:a,parts:[s]})}return r}function v(e,t){var r=s(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),d.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=s(e.insertAt.before,r);r.insertBefore(t,o)}}function h(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function b(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=function(){0;return r.nc}();n&&(e.attrs.nonce=n)}return m(t,e.attrs),v(e,t),t}function m(e,t){Object.keys(t).forEach(function(r){e.setAttribute(r,t[r])})}function w(e,t){var r,n,o,i;if(t.transform&&e.css){if(!(i=t.transform(e.css)))return function(){};e.css=i}if(t.singleton){var a=c++;r=l||(l=b(t)),n=x.bind(null,r,a,!1),o=x.bind(null,r,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),v(e,t),t}(t),n=function(e,t,r){var n=r.css,o=r.sourceMap,i=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||i)&&(n=p(n));o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,r,t),o=function(){h(r),r.href&&URL.revokeObjectURL(r.href)}):(r=b(t),n=function(e,t){var r=t.css,n=t.media;n&&e.setAttribute("media",n);if(e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,r),o=function(){h(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=f(e,t);return u(r,t),function(e){for(var n=[],o=0;o<r.length;o++){var a=r[o];(s=i[a.id]).refs--,n.push(s)}e&&u(f(e,t),t);for(o=0;o<n.length;o++){var s;if(0===(s=n[o]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete i[s.id]}}}};var g,y=(g=[],function(e,t){return g[e]=t,g.filter(Boolean).join("\n")});function x(e,t,r,n){var o=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=y(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var o,i=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?r+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")})}},function(e,t){e.exports='<div class=freelog-alpha-markdownviewer-app>\n  <div class="wrapper js-wrapper">\n    <div class=md-titles>\n      <ul class=js-md-titles></ul>\n    </div>\n    <div class="md-viewer-wrap article-item">\n      <div class=js-md-title></div>\n      <div class="md-content-viewer article-content js-md-viewer"></div>\n    </div>\n  </div>\n</div>\n'},function(e){e.exports={name:"freelog-alpha-markdownviewer",version:"0.0.1",description:"A freelog widget",main:"index.js",scripts:{dev:"node build/dev-server.js",start:"node build/dev-server.js",build:"node build/build.js",publish:"freelog-cli publish beta -f ./dist/freelog-alpha-markdownviewer.js"},keywords:[],author:"",license:"MIT",freelogConfig:{type:"widget",meta:{},dependencies:{"markdown-parser":"dde4ef349881285fb545b038e471e0c519e4c200"}},devDependencies:{"@freelog/freelog-dev-server":"^0.0.10","babel-core":"^6.26.0","babel-loader":"^7.1.5","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-external-helpers":"^6.22.0","babel-plugin-transform-custom-element-classes":"^0.1.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.7.0","babel-preset-stage-2":"^6.24.1",chalk:"^2.4.1","css-loader":"^0.28.11",del:"^3.0.0","extract-text-webpack-plugin":"^3.0.2","fancy-log":"^1.3.2","file-loader":"^1.1.11","friendly-errors-webpack-plugin":"^1.7.0","html-loader":"^0.5.5",less:"^3.5.2","less-loader":"^4.1.0","mini-css-extract-plugin":"^0.4.1",opn:"^5.3.0",ora:"^3.0.0","postcss-loader":"^2.1.5",rimraf:"^2.6.2","run-sequence":"^2.2.1","style-loader":"^0.23.0","terser-webpack-plugin":"^1.2.0","url-loader":"^1.0.1",webpack:"^4.15.1","webpack-cli":"^3.0.8","webpack-merge":"^4.1.3","webpack-stream":"^4.0.3"},engines:{node:">= 6.0.0"}}}]);
//# sourceMappingURL=freelog-alpha-markdownviewer.js.map